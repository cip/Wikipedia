<!DOCTYPE HTML>

<html>

<head>

<title>PhoneGap</title>

</head>

<body>

	<!-- Button -->
	<input id="zimFileName" name="articleTitle" type="text" value="//sdcard/wikipedia-de.zim">	
	<input id="articleTitle" name="articleTitle" type="text" value="Graz">	
	<input disabled id="list-sdcard" type="button"
		value="List SDCard Contents" />
	<input disabled id="zimtest" type="button" value="zimtest" />
	<hr>
	<div id="status"></div>
	<hr>	

	<!-- Place Holder for placing the SD Card Listing -->

	<div id="result"></div>



	<hr>



	<script type="text/javascript" src="phonegap-1.0.0.js"></script>

	<script type="text/javascript" src="directorylisting.js"></script>
	<script type="text/javascript">
		document.addEventListener('deviceready', function() {

			var btn = document.getElementById("list-sdcard");
	
			btn.onclick = function() {
				btn.disabled = true;
				window.plugins.directoryListing.list("/sdcard",

				function(r) {
					btn.disabled = false;
					printResult(r)					
				},

				function(e) {
					btn.disabled = false;
					console.log(e)
				}

				);

			}

			btn.disabled = false;
			
			var btn = document.getElementById("zimtest");
			
			btn.onclick = function() {
				btn.disabled = true;
				clearArticle();
				showStatus("Loading article "+document.getElementById("articleTitle").value+" from file: "+document.getElementById("zimFileName").value);
				window.plugins.directoryListing.zimtest(document.getElementById("zimFileName").value, 
						document.getElementById("articleTitle").value, 
						
				function(r) {
					btn.disabled = false;
					showStatus("Article loaded. Render article...");
					showArticle(r)
				},

				function(e) {
					btn.disabled = false;
					showStatus("Error loading article");
					console.log(e)
				}

				);
				
			}

			btn.disabled = false;
						

		}, true);

		function printResult(fileInfo) {

			var innerHtmlText = getHtml(fileInfo);

			document.getElementById("result").innerHTML = innerHtmlText;

		}
		
		function showStatus(status) {
			document.getElementById("status").innerHTML = status;
		}
		
		function clearArticle() {
			document.getElementById("result").innerHTML = "";
		}
		function showArticle(articleText) {
			
			document.getElementById("result").innerHTML = articleText.articletext;

		}


		function getHtml(fileInfo) {

			var htmlText = "<ul><li>" + fileInfo.filename;

			if (fileInfo.children) {

				for ( var index = 0; index < fileInfo.children.length; index++) {

					htmlText = htmlText + getHtml(fileInfo.children[index]);

				}

			}

			htmlText = htmlText + "</li></ul>";

			return htmlText;

		}
	</script>



</body>

</html>